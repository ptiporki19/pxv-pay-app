const { createClient } = require("@supabase/supabase-js"); const supabaseUrl = "http://127.0.0.1:54321"; const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"; async function testWebLogin() { console.log("🔐 Testing web login functionality..."); try { const supabase = createClient(supabaseUrl, supabaseKey); const email = "admin@pxvpay.com"; const password = "admin123456"; console.log(`📧 Attempting login with: ${email}`); const { data, error } = await supabase.auth.signInWithPassword({ email: email, password: password }); if (error) { console.error("❌ Login failed:", error.message); return false; } if (data.user) { console.log("✅ Login successful!"); console.log("👤 User ID:", data.user.id); console.log("📧 Email:", data.user.email); console.log("🔑 Session token exists:", !!data.session?.access_token); const { data: profile, error: profileError } = await supabase.from("users").select("*").eq("id", data.user.id).single(); if (profileError) { console.error("⚠️ Profile fetch error:", profileError.message); } else { console.log("👤 User profile:", { id: profile.id, email: profile.email, role: profile.role, active: profile.active }); } await supabase.auth.signOut(); console.log("🚪 Signed out successfully"); return true; } else { console.error("❌ No user data returned"); return false; } } catch (error) { console.error("💥 Unexpected error:", error.message); return false; } } testWebLogin().then(success => { if (success) { console.log("\n🎉 Web login test PASSED!"); process.exit(0); } else { console.log("\n💥 Web login test FAILED!"); process.exit(1); } }).catch(error => { console.error("💥 Test script error:", error); process.exit(1); });
