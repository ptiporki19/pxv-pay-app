const { createClient } = require("@supabase/supabase-js"); const supabaseUrl = "http://127.0.0.1:54321"; const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"; async function testWebLogin() { console.log("ðŸ” Testing web login functionality..."); try { const supabase = createClient(supabaseUrl, supabaseKey); const email = "admin@pxvpay.com"; const password = "admin123456"; console.log(`ðŸ“§ Attempting login with: ${email}`); const { data, error } = await supabase.auth.signInWithPassword({ email: email, password: password }); if (error) { console.error("âŒ Login failed:", error.message); return false; } if (data.user) { console.log("âœ… Login successful!"); console.log("ðŸ‘¤ User ID:", data.user.id); console.log("ðŸ“§ Email:", data.user.email); console.log("ðŸ”‘ Session token exists:", !!data.session?.access_token); const { data: profile, error: profileError } = await supabase.from("users").select("*").eq("id", data.user.id).single(); if (profileError) { console.error("âš ï¸ Profile fetch error:", profileError.message); } else { console.log("ðŸ‘¤ User profile:", { id: profile.id, email: profile.email, role: profile.role, active: profile.active }); } await supabase.auth.signOut(); console.log("ðŸšª Signed out successfully"); return true; } else { console.error("âŒ No user data returned"); return false; } } catch (error) { console.error("ðŸ’¥ Unexpected error:", error.message); return false; } } testWebLogin().then(success => { if (success) { console.log("\nðŸŽ‰ Web login test PASSED!"); process.exit(0); } else { console.log("\nðŸ’¥ Web login test FAILED!"); process.exit(1); } }).catch(error => { console.error("ðŸ’¥ Test script error:", error); process.exit(1); });
